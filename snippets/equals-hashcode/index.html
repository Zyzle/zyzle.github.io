<!doctype html><html lang=en><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,minimum-scale=1" name=viewport><meta name=description><title>Override equals and hashCode correctly | Zyzle.dev</title><link href=https://zyzle.dev/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://zyzle.dev/styles.css rel=stylesheet><link href=/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/site.webmanifest rel=manifest><body><header class=page-header><div class=hwrapper><h1><a class=header-link href=https://zyzle.dev/>Zyzle.dev</a></h1><span class=header-buttons> <a href=https://ko-fi.com/zyzle><img alt="support me on Ko-fi" src=/ko-fi.png width=50px></a> <h1><a href=/tags>#</a></h1> </span></div><div id=progress-bar></div></header><div class=wrapper><main class=content id=docmain><article class=post><header class=post-header><h1>Override equals and hashCode correctly</h1><div class=post-info><time datetime=2022-03-31>2022-03-31</time><div class=tags><a href=https://zyzle.dev/tags/snippet>snippet</a></div></div></header><p>A Java classes <code>equals</code> and <code>hashCode</code> methods should always be overridden in pairs, the following shows how to do this manually without using 3rd party libraries<pre class=language-java data-lang=java style=background-color:#282c34;color:#abb2bf;><code class=language-java data-lang=java><span style=color:#e06c75;>public </span><span style=color:#56b6c2;>class </span><span style=color:#61afef;>Stock </span><span>{
</span><span>    </span><span style=color:#e06c75;>private </span><span style=color:#56b6c2;>int </span><span>tickSize;
</span><span>    </span><span style=color:#e06c75;>private </span><span style=color:#56b6c2;>long </span><span>lotSize;
</span><span>    </span><span style=color:#e06c75;>private </span><span style=color:#56b6c2;>boolean </span><span>isRestricted;
</span><span>    </span><span style=color:#e06c75;>private </span><span style=color:#61afef;>String </span><span>symbol;
</span><span>    </span><span style=color:#e06c75;>private </span><span style=color:#61afef;>String </span><span>exchange;
</span><span>    </span><span style=color:#e06c75;>private </span><span style=color:#61afef;>Date </span><span>settlementDate;
</span><span>    </span><span style=color:#e06c75;>private </span><span style=color:#61afef;>BigDecimal </span><span>price;
</span><span>        
</span><span>    @Override
</span><span>    </span><span style=color:#e06c75;>public </span><span style=color:#56b6c2;>int </span><span style=color:#98c379;>hashCode</span><span>() {
</span><span>        </span><span style=color:#e06c75;>final </span><span style=color:#56b6c2;>int</span><span> prime </span><span style=color:#e06c75;>= </span><span style=color:#c678dd;>31</span><span>;
</span><span>        </span><span style=color:#56b6c2;>int</span><span> result </span><span style=color:#e06c75;>= </span><span style=color:#c678dd;>1</span><span>;
</span><span>        result </span><span style=color:#e06c75;>=</span><span> prime </span><span style=color:#e06c75;>*</span><span> result </span><span style=color:#e06c75;>+</span><span> tickSize;
</span><span>        result </span><span style=color:#e06c75;>=</span><span> prime </span><span style=color:#e06c75;>*</span><span> result </span><span style=color:#e06c75;>+ </span><span>(</span><span style=color:#56b6c2;>int</span><span>) (lotSize </span><span style=color:#e06c75;>^ </span><span>(lotSize </span><span style=color:#e06c75;>>>> </span><span style=color:#c678dd;>32</span><span>));
</span><span>        result </span><span style=color:#e06c75;>=</span><span> prime </span><span style=color:#e06c75;>*</span><span> result </span><span style=color:#e06c75;>+ </span><span>(isRestricted </span><span style=color:#e06c75;>? </span><span style=color:#c678dd;>1231 </span><span style=color:#e06c75;>: </span><span style=color:#c678dd;>1237</span><span>);
</span><span>        result </span><span style=color:#e06c75;>=</span><span> prime </span><span style=color:#e06c75;>*</span><span> result </span><span style=color:#e06c75;>+ </span><span>((symbol </span><span style=color:#e06c75;>== </span><span style=color:#56b6c2;>null</span><span>) </span><span style=color:#e06c75;>? </span><span style=color:#c678dd;>0 </span><span style=color:#e06c75;>:</span><span> symbol.hashCode());
</span><span>        result </span><span style=color:#e06c75;>=</span><span> prime </span><span style=color:#e06c75;>*</span><span> result </span><span style=color:#e06c75;>+ </span><span>((exchange </span><span style=color:#e06c75;>== </span><span style=color:#56b6c2;>null</span><span>) </span><span style=color:#e06c75;>? </span><span style=color:#c678dd;>0 </span><span style=color:#e06c75;>:</span><span> exchange.hashCode());
</span><span>        result </span><span style=color:#e06c75;>=</span><span> prime </span><span style=color:#e06c75;>*</span><span> result </span><span style=color:#e06c75;>+ </span><span>((settlementDate </span><span style=color:#e06c75;>== </span><span style=color:#56b6c2;>null</span><span>) </span><span style=color:#e06c75;>? </span><span style=color:#c678dd;>0 </span><span style=color:#e06c75;>:</span><span> settlementDate.hashCode());
</span><span>        result </span><span style=color:#e06c75;>=</span><span> prime </span><span style=color:#e06c75;>*</span><span> result </span><span style=color:#e06c75;>+ </span><span>((price </span><span style=color:#e06c75;>== </span><span style=color:#56b6c2;>null</span><span>) </span><span style=color:#e06c75;>? </span><span style=color:#c678dd;>0 </span><span style=color:#e06c75;>:</span><span> price.hashCode());
</span><span>        </span><span style=color:#e06c75;>return</span><span> result;
</span><span>    }
</span><span>
</span><span>    @Override
</span><span>    </span><span style=color:#e06c75;>public </span><span style=color:#56b6c2;>boolean </span><span style=color:#98c379;>equals</span><span>(</span><span style=color:#61afef;>Object </span><span style=font-style:italic;color:#d19a66;>obj</span><span>) {
</span><span>        </span><span style=color:#e06c75;>if </span><span>(</span><span style=color:#e06c75;>this ==</span><span> obj) </span><span style=color:#e06c75;>return </span><span style=color:#56b6c2;>true</span><span>;
</span><span>        </span><span style=color:#e06c75;>if </span><span>(obj </span><span style=color:#e06c75;>== </span><span style=color:#56b6c2;>null </span><span style=color:#e06c75;>|| this</span><span>.getClass() </span><span style=color:#e06c75;>!=</span><span> obj.getClass()){
</span><span>            </span><span style=color:#e06c75;>return </span><span style=color:#56b6c2;>false</span><span>;
</span><span>        }
</span><span>
</span><span>        </span><span style=color:#61afef;>Stock</span><span> other </span><span style=color:#e06c75;>= </span><span>(</span><span style=color:#61afef;>Stock</span><span>) obj;
</span><span>
</span><span>        </span><span style=color:#e06c75;>return  
</span><span>            </span><span style=color:#e06c75;>this</span><span>.tickSize </span><span style=color:#e06c75;>==</span><span> other.tickSize </span><span style=color:#e06c75;>&& this</span><span>.lotSize </span><span style=color:#e06c75;>==</span><span> other.lotSize </span><span style=color:#e06c75;>&& 
</span><span>            </span><span style=color:#e06c75;>this</span><span>.isRestricted </span><span style=color:#e06c75;>==</span><span> other.isRestricted </span><span style=color:#e06c75;>&&
</span><span>            (</span><span style=color:#e06c75;>this</span><span>.symbol </span><span style=color:#e06c75;>==</span><span> other.symbol</span><span style=color:#e06c75;>|| </span><span>(</span><span style=color:#e06c75;>this</span><span>.symbol </span><span style=color:#e06c75;>!= </span><span style=color:#56b6c2;>null </span><span style=color:#e06c75;>&& this</span><span>.symbol.equals(other.symbol))) </span><span style=color:#e06c75;>&& 
</span><span>            (</span><span style=color:#e06c75;>this</span><span>.exchange </span><span style=color:#e06c75;>==</span><span> other.exchange</span><span style=color:#e06c75;>|| </span><span>(</span><span style=color:#e06c75;>this</span><span>.exchange </span><span style=color:#e06c75;>!= </span><span style=color:#56b6c2;>null </span><span style=color:#e06c75;>&& this</span><span>.exchange.equals(other.exchange))) </span><span style=color:#e06c75;>&&
</span><span>            (</span><span style=color:#e06c75;>this</span><span>.settlementDate </span><span style=color:#e06c75;>==</span><span> other.settlementDate</span><span style=color:#e06c75;>|| </span><span>(</span><span style=color:#e06c75;>this</span><span>.settlementDate </span><span style=color:#e06c75;>!= </span><span style=color:#56b6c2;>null </span><span style=color:#e06c75;>&& this</span><span>.settlementDate.equals(other.settlementDate))) </span><span style=color:#e06c75;>&&
</span><span>            (</span><span style=color:#e06c75;>this</span><span>.price </span><span style=color:#e06c75;>==</span><span> other.price</span><span style=color:#e06c75;>|| </span><span>(</span><span style=color:#e06c75;>this</span><span>.price </span><span style=color:#e06c75;>!= </span><span style=color:#56b6c2;>null </span><span style=color:#e06c75;>&& this</span><span>.price.equals(other.price)));
</span><span>    }
</span><span>}
</span></code></pre><p>The Java <code>equals</code> contract defines that the method must be:<ul><li><strong>Reflexive</strong>: An object must equal itself<li><strong>Symetric</strong>: if <code>x.equals(y)</code> then <code>y.equals(x)</code><li><strong>Transitive</strong>: if <code>x.equals(y)</code> and <code>y.equals(z)</code> then <code>x.equals(z)</code><li><strong>Consistent</strong>: The value should only change if a member used in the calculation changes i.e. no randomness.</ul><p><code>hashCode</code> calculation is related to the <code>equals</code> method in the following ways<ul><li><strong>Internal Consistency</strong>: The value can only change if a member used in the <code>equals</code> calculation changes<li><strong>Equals Consistency</strong>: If two objects are <code>equal</code> then they must have the same <code>hashCode</code><li><strong>Collisions</strong>: unequal objects <em>may</em> have the same <code>hashCode</code>, nothing in the definition prohibits this</ul></article></main></div><script>(() => {
                const bar = document.querySelector('#progress-bar');
                const post = document.querySelector('#docmain');
                const html = document.documentElement;
                const height = post.scrollHeight;

                window.addEventListener('scroll', () => {
                    bar.style.width = (html.scrollTop / (height - html.clientHeight)) * 100 + '%';
                });
            })();</script><script async data-dnt=false data-host=https://microanalytics.io defer id=ZwSg9rf6GA src=https://microanalytics.io/js/script.js></script>